{
  "project_overview": {
    "application_name": "Chess Wizard",
    "purpose": "Chess Wizard is a fully local, AI-powered chess application designed to provide real-time move suggestions, analysis, and gameplay for users of all skill levels, from beginners to advanced players.",
    "target_audience": {
      "skill_levels": ["Beginner", "Intermediate", "Advanced", "Professional"],
      "use_cases": ["Practice games against AI", "Real-time move suggestions", "Post-game analysis", "Tactical training", "Opening preparation"]
    },
    "core_value_proposition": "Provide accurate, efficient, and real-time chess move suggestions using a high-performance C++ engine with advanced search and evaluation algorithms, fully localized with no cloud dependency.",
    "success_metrics": {
      "accuracy": "Engine's suggested move matches top 3 engine moves in ≥95% of cases at depth 20",
      "performance": "Moves calculated within 2 seconds on standard desktop CPU with default time settings",
      "user_engagement": "Average session length ≥30 minutes and ≥5 games per user per week",
      "stability": "Zero crashes during gameplay; memory leaks ≤1 per 10,000 moves"
    }
  },
  "system_architecture": {
    "high_level_architecture": {
      "components": [
        "C++ Chess Engine Core",
        "Local GUI (desktop application using Qt5/Qt6)",
        "Persistent Storage Module (SQLite for game history and user settings)",
        "Resource Manager (assets, opening book, NNUE weights)",
        "Logging and Analytics Module"
      ],
      "data_flow": {
        "user_input": "GUI → Input Parser → Chess Engine Core",
        "engine_output": "Chess Engine Core → Move Suggestion → GUI",
        "game_persistence": "Engine/GUI → SQLite storage",
        "analysis_output": "Engine → Evaluation Data → GUI Graphs/Side Panel"
      },
      "deployment": {
        "architecture": "Fully local desktop application",
        "platforms": ["Windows 10+", "macOS 10.15+", "Linux x86_64"],
        "installation": "Single binary installer with embedded resources"
      }
    },
    "chess_engine_core": {
      "engine_implementation": {
        "language": "C++17",
        "justification": [
          "High performance required for bitboard manipulations and alpha-beta search",
          "Deterministic memory management",
          "Full control over compiler optimizations",
          "Compatibility with modern C++ standard library features"
        ],
        "compiler_requirements": ["GCC ≥10", "Clang ≥12", "MSVC ≥2019"],
        "optimization_flags": ["-O3", "-march=native", "-flto", "-funroll-loops", "-fomit-frame-pointer"],
        "build_system": {
          "cmake_minimum_required": "3.18",
          "targets": ["chess_wizard", "unit_tests", "cli_tools"],
          "directory_structure": {
            "src/engine": ["board.cpp", "board.h", "movegen.cpp", "movegen.h", "search.cpp", "search.h", "evaluation.cpp", "evaluation.h", "uci.cpp", "uci.h", "nnue.cpp", "nnue.h", "tt.cpp", "tt.h"],
            "src/gui": ["mainwindow.cpp", "mainwindow.h", "chessboardwidget.cpp", "chessboardwidget.h", "sidepanel.cpp", "sidepanel.h"],
            "src/storage": ["sqlite_manager.cpp", "sqlite_manager.h", "opening_book.cpp", "opening_book.h"],
            "include": ["common.h", "constants.h", "types.h", "utils.h"],
            "tests": ["perft_tests.cpp", "evaluation_tests.cpp", "movegen_tests.cpp", "integration_tests.cpp"],
            "resources": ["nnue_weights.bin", "opening_book.bin", "piece_svgs/", "icons/"]
          }
        }
      },
      "core_modules": {
        "board_representation": {
          "bitboard": {
            "type": "uint64_t",
            "pieces": ["WP", "WN", "WB", "WR", "WQ", "WK", "BP", "BN", "BB", "BR", "BQ", "BK"],
            "layout": "Each bit represents a square a1-h8 (LSB a1, MSB h8)",
            "state_tracking": {
              "castling_rights": "uint8_t bits: white_kingside, white_queenside, black_kingside, black_queenside",
              "en_passant_file": "int8_t (-1 if none, 0-7 for files a-h)",
              "halfmove_clock": "uint16_t",
              "fullmove_number": "uint16_t"
            },
            "zobrist_hashing": {
              "tables": ["piece_square[12][64]", "side_to_move", "castling[16]", "ep_file[8]"],
              "key_type": "uint64_t",
              "collision_probability": "<1e-15"
            }
          }
        },
        "move_generation": {
          "legal_moves": "Generated using precomputed attack tables; pseudo-legal moves filtered for king safety",
          "move_encoding": {
            "type": "uint32_t",
            "fields": {
              "from_square": "bits 0-5",
              "to_square": "bits 6-11",
              "moving_piece": "bits 12-15",
              "captured_piece": "bits 16-19",
              "promotion_piece": "bits 20-22",
              "flags": "bits 23-25 (castling, en passant, double pawn push)"
            }
          },
          "special_moves": ["castling", "en_passant", "pawn_promotions"],
          "attack_detection": "Bitboard masks and precomputed tables for knight, bishop, rook, queen, king, and pawns",
          "check_validation": "Simulated move and king safety check before accepting legal move"
        },
        "search_algorithm": {
          "iterative_deepening": "Depth-limited search with increasing depth until time or max depth reached",
          "alpha_beta_pruning": "Negamax with alpha-beta cutoffs",
          "principal_variation_search": "PVS optimization to reduce search window for non-first moves",
          "transposition_table": {
            "entry_structure": {
              "key": "uint64_t",
              "move": "uint32_t",
              "score": "int32_t",
              "depth": "uint8_t",
              "flags": "uint8_t",
              "age": "uint8_t"
            },
            "size": "Configurable, default 32MB",
            "replacement_policy": "Deeper depth preferred, then youngest age"
          },
          "move_ordering": ["TT move first", "captures ordered by MVV-LVA", "killer moves", "history heuristic"],
          "quiescence_search": "Extends search at leaf nodes for captures, checks, and promotions to reduce horizon effect",
          "pruning": ["null-move pruning with depth reduction", "futility pruning at low depth", "late move reductions for non-critical moves"]
        },
        "evaluation": {
          "material_values": {"P": 100, "N": 320, "B": 330, "R": 500, "Q": 900, "K": 20000},
          "piece_square_tables": "64-value table per piece type for opening and endgame phases",
          "positional_evaluation": ["pawn structure: doubled, isolated, passed", "king safety: pawn shield, attacker count", "mobility: number of legal moves per piece"],
          "function_signature": "int evaluate(const Board &board, const EvaluationOptions &options)"
        },
        "uci_protocol": {
          "commands": ["uci", "isready", "position", "go", "stop", "quit", "setoption"],
          "engine_communication": "Stdout/StdIn text-based command parsing",
          "position_parsing": "Supports FEN strings and move lists in UCI format"
        }
      },
      "performance_optimization": {
        "cache_optimization": "Move lists, bitboards, and NNUE features preallocated; memory aligned to 64 bytes",
        "branch_prediction": "Hot paths optimized with likely/unlikely macros",
        "cpu_instructions": ["SSE2 for bit operations", "AVX2 for NNUE vector math"],
        "profiling": "Integrated perft and nodes-per-second benchmarks; logging via debug macro"
      }
    }
  },
  "backend_specifications": {
    "api_layer": "Not applicable for local-only architecture",
    "data_storage": {
      "game_state": "SQLite DB; tables: games(id, fen_sequence, result, timestamps)",
      "opening_book": "Binary Polyglot format embedded in resources",
      "user_preferences": "SQLite table settings(key, value)",
      "analytics_logging": "Local logs for session duration, engine response time, move statistics"
    },
    "performance_requirements": {
      "nodes_per_second": "≥3 million on mid-range CPU",
      "memory_limit": "≤200MB RAM for engine + UI",
      "response_time": "≤2 seconds per suggested move",
      "concurrent_users": "Single-user desktop"
    }
  },
  "frontend_ui_specifications": {
    "application_structure": {
      "pages": [
        {"name": "Main Game", "purpose": "Play game with engine suggestions"},
        {"name": "Analysis", "purpose": "Post-game analysis and move exploration"},
        {"name": "Settings", "purpose": "Engine options, themes, piece sets"},
        {"name": "Opening Explorer", "purpose": "Explore openings, statistics, and frequency charts"}
      ],
      "navigation_flows": "Menu bar at top; side panel for moves and evaluation; context-sensitive modals for settings and analysis"
    },
    "main_game_page": {
      "layout": {
        "chessboard": {"width": 480, "height": 480, "top_left": [20,20]},
        "side_panel": {"width": 250, "height": 480, "top_left": [510,20]},
        "engine_controls": {"buttons": ["Suggest Move", "Undo", "Redo", "New Game"], "size": [100,40], "spacing": 10},
        "move_history_list": {"position": [520,50], "font": "Roboto 14px"}
      },
      "chessboard": {
        "square_size": 60,
        "colors": {"light": "#F0D9B5", "dark": "#B58863"},
        "piece_images": {"format": "SVG", "size": 60x60, "source": "resources/pieces/"},
        "highlight_colors": {"legal_move": "#00FF00AA", "last_move": "#FFFF00AA", "check": "#FF0000AA"}
      },
      "side_panel": {
        "evaluation_bar": {"width": 20, "height": 480, "gradient": ["#00FF00", "#FF0000"]},
        "clock_display": {"font": "Roboto 18px", "position": [600,500]},
        "engine_controls": {"button_labels": ["Suggest Move", "Undo", "Redo", "New Game"], "font": "Roboto 14px"}
      }
    },
    "analysis_page": {
      "engine_lines_display": {"max_lines": 5, "font": "Monaco 12px"},
      "evaluation_graph": {"width": 700, "height": 300},
      "move_tree_visualization": {"expandable_nodes": true},
      "annotation_tools": ["Text annotation", "Arrow drawing", "Highlight squares"]
    },
    "settings_page": {
      "engine_config": ["Max Depth", "Time per Move", "Use NNUE"],
      "board_theme": ["Light", "Dark", "Wood", "Classic"],
      "piece_set_selection": ["Standard", "Modern", "Alpha", "Beta"],
      "engine_strength": ["Beginner", "Intermediate", "Advanced", "Master"]
    },
    "opening_explorer_page": {
      "tree_visualization": {"max_depth": 12, "node_spacing": 60},
      "statistics_display": {"games_played": true, "win_rate": true},
      "position_frequency_chart": {"type": "bar", "color": "#3366CC"}
    }
  },
  "ui_component_library": {
    "chessboard_component": {
      "states": ["default", "highlighted", "selected", "check"],
      "ARIA_labels": {"board": "Chessboard", "square": "Chess square"},
      "animation": {"move_duration": 0.25, "easing": "ease-in-out"}
    },
    "piece_component": {"states": ["default", "dragging", "promoting"], "ARIA": {"role": "img", "label": "Chess piece"}},
    "move_list_component": {"states": ["normal", "hovered", "selected"], "font": "Monaco 12px"},
    "evaluation_bar": {"gradient": ["#00FF00", "#FF0000"], "orientation": "vertical"},
    "buttons": {"variants": ["default", "hover", "active", "disabled"], "size": [100,40], "animation": {"duration": 0.2, "ease": "linear"}},
    "modal_dialogs": {"overlay_color": "#000000AA", "animation": {"fade_in": 0.2, "fade_out": 0.2}},
    "sliders": {"track_color": "#CCCCCC", "thumb_color": "#3366CC"},
    "dropdown_menus": {"font": "Roboto 14px", "hover_color": "#EEEEEE"}
  },
  "ux_specifications": {
    "user_flows": {
      "new_game": {"trigger": "menu click", "response": "reset board, reset timers, clear move history", "loading_state": "none", "error_state": "invalid FEN not possible", "success_confirmation": "Board ready for new game"},
      "make_move": {"trigger": "click or drag", "response": "move applied, engine suggestion updated", "loading_state": "highlight legal squares", "error_state": "illegal move reverted", "success_confirmation": "Move applied"},
      "engine_suggestion": {"trigger": "button click", "response": "highlight suggested move", "loading_state": "spinner 0.25s", "success_confirmation": "Move highlighted"},
      "undo_redo": {"trigger": "button click", "response": "board state updated", "loading_state": "none", "success_confirmation": "Move undone/redone"},
      "save_load_game": {"trigger": "menu click", "response": "open file dialog, write/read SQLite DB", "success_confirmation": "Game saved/loaded successfully"},
      "position_analysis": {"trigger": "select position", "response": "display engine lines and evaluation graph"}
    },
    "animations_transitions": {
      "piece_move": {"duration": 0.25, "easing": "ease-in-out"},
      "page_transition": {"type": "fade", "duration": 0.3},
      "loading_spinner": {"duration": 1.0, "loop": true},
      "hover_effect": {"color_change": "#EEEEEE", "duration": 0.15}
    },
    "microinteractions": {
      "click_feedback": "button opacity change 0.1s",
      "drag_drop_cue": "piece slightly enlarges 1.1x while dragging",
      "tooltip": {"appearance_delay": 0.3, "disappearance_delay": 0.2},
      "notifications": {"slide_in": 0.2, "slide_out": 0.2, "color": "#3366CC"},
      "sound_effects": {"move": "click.wav", "capture": "capture.wav"}
    }
  },
  "visual_design_system": {
    "typography": {
      "primary_font": "Roboto",
      "secondary_font": "Monaco",
      "headings": {"h1": 32, "h2": 28, "h3": 24, "h4": 20, "h5": 16, "h6": 14},
      "line_height": 1.5,
      "letter_spacing": 0.5,
      "weights": {"normal": 400, "medium": 500, "bold": 700},
      "text_colors": {"primary": "#000000", "secondary": "#555555", "disabled": "#AAAAAA"}
    },
    "color_palette": {
      "primary": "#3366CC",
      "secondary": "#FFCC00",
      "accent": "#33CC99",
      "background_light": "#FFFFFF",
      "background_dark": "#121212",
      "status_colors": {"success": "#00FF00", "warning": "#FF9900", "error": "#FF0000", "info": "#0099FF"},
      "chess_colors": {"move_highlight": "#00FF00AA", "last_move": "#FFFF00AA", "check": "#FF0000AA"}
    },
    "spacing_system": {
      "base_unit": 8,
      "scale": [0, 4, 8, 12, 16, 24, 32, 48, 64],
      "component_spacing": {"padding": 12, "margin": 12, "gap": 8},
      "layout_grid": {"columns": 12, "gutter": 16}
    },
    "icons_and_imagery": {
      "icon_set": "SVG icons in resources/icons/",
      "piece_images": "SVG, 60x60 px",
      "logo": "SVG 128x128",
      "favicon": "PNG 32x32"
    }
  },
  "responsive_design": {
    "breakpoints": {"mobile": 480, "tablet": 768, "desktop": 1024},
    "layout_adjustments": "Chessboard scales to max width 80% of container, side panel collapses below 768px",
    "touch_target_sizes": "Minimum 44x44 px",
    "mobile_gestures": ["drag-and-drop", "tap-to-select"]
  },
  "integration_specifications": {
    "engine_integration": {
      "communication": "Direct C++ function calls within single process",
      "data_serialization": "In-memory C++ structs, no network serialization",
      "error_handling": "Return error codes, log to file",
      "performance_monitoring": "Internal logging of nodes/sec, time per move"
    },
    "external_services": "None; fully local execution"
  },
  "testing_specifications": {
    "engine_testing": {
      "perft_tests": "Validate move generation to depth 6; exact node counts",
      "position_tests": ["tactical", "positional", "checkmate detection", "stalemate detection"],
      "performance_benchmarks": "Nodes/sec measurements on various CPU configurations",
      "memory_leak_tests": "Valgrind or AddressSanitizer run"
    },
    "ui_testing": {
      "unit_tests": "Each component tested for rendering, state changes, and events",
      "integration_tests": "Engine responses reflected correctly on UI",
      "end_to_end_tests": "Simulate game flow, new game, undo/redo, move suggestions",
      "cross_browser_testing": "Qt cross-platform desktop testing"
    },
    "quality_assurance": {
      "performance": "Target 3M nodes/sec with <2s response",
      "security": "Validate FEN input, sanitize logs",
      "accessibility": "Keyboard navigation, ARIA labels",
      "localization": "Support for English; other languages optional"
    }
  },
  "development_workflow": {
    "build_process": {
      "environment_setup": "CMake + GCC/Clang/MSVC; Qt5/6 installed",
      "dependency_management": "CMake ExternalProject for SQLite, Qt, optional NNUE library",
      "ci_pipeline": "Automated build, unit tests, perft validation"
    },
    "code_organization": {
      "file_naming": "snake_case for source, PascalCase for classes",
      "directory_structure": "As specified in engine_implementation",
      "code_style": "Google C++ Style Guide",
      "documentation": "Doxygen for C++ modules, Markdown for UI specs"
    },
    "deployment": {
      "packaging": "Single installer (NSIS for Windows, DMG for macOS, AppImage for Linux)",
      "installation": "Installer includes binaries, resources, NNUE weights",
      "update_mechanism": "Manual update; optional auto-check via local file version",
      "system_requirements": {"CPU": "x86_64 2.0 GHz", "RAM": "4GB", "Storage": "200MB"}
    }
  },
  "documentation": {
    "technical": {
      "api_docs": "Doxygen-generated for all engine classes/functions",
      "architecture_decisions": "Markdown ADR files describing search, evaluation, and UCI design",
      "performance_profiling": "Guides for perft, nodes/sec, NNUE performance",
      "troubleshooting": "Common errors and fixes for engine startup, illegal move detection, GUI rendering"
    },
    "user": {
      "getting_started": "Step-by-step guide for installation and first game",
      "feature_explanation": "Descriptions for each UI page and engine feature",
      "keyboard_shortcuts": ["Ctrl+Z: Undo", "Ctrl+Y: Redo", "Space: Suggest move", "Ctrl+N: New game"],
      "faqs": ["How to reset engine?", "How to change piece set?", "How to load game?"]
    }
  },
  "performance_metrics_and_monitoring": {
    "engine_metrics": {
      "nodes_per_second": "Target ≥3M",
      "hash_table_usage": "Monitor % of entries used",
      "search_depth": "Track max depth achieved per game",
      "branching_factor": "Average branching factor recorded"
    },
    "application_metrics": {
      "load_time": "≤2 seconds",
      "frame_rate": "≥60fps for UI animations",
      "memory_usage": "≤200MB",
      "network_usage": "None (local-only)"
    }
  },
  "security_considerations": {
    "input_validation": "FEN strings validated; illegal characters rejected",
    "sanitization": "Logs sanitized before writing",
    "data_protection": "Local file permissions enforced",
    "privacy": "No external connections; all user data stored locally"
  },
  "accessibility": {
    "screen_reader_compatibility": "ARIA labels on all interactive elements",
    "keyboard_navigation": "Tab order for menus, piece selection, engine buttons",
    "color_contrast": "Minimum 4.5:1 ratio for all text and highlights",
    "focus_management": "Focus indicators on selected squares and UI elements"
  },
  "internationalization": {
    "language_support": ["English (default)"],
    "date_time_formats": "ISO 8601",
    "number_formats": "Decimal with dot separator",
    "rtl_support": "Not implemented in initial version"
  },
  "future_extensions": {
    "planned_features": ["Multiplayer over LAN", "Cloud sync for game history", "Expanded NNUE training sets"],
    "architecture_considerations": "Modular engine design allows cloud integration without changing core engine",
    "upgrade_paths": "Settings and resources versioned for seamless upgrade"
  },
  "compliance_and_licensing": {
    "open_source_license": "MIT",
    "third_party_dependencies": ["Qt5/6: LGPL", "SQLite: Public Domain", "NNUE library: GPLv3 (optional)"],
    "compliance_requirements": "No proprietary code linked without license compliance"
  }
}